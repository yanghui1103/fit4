<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="roleSql">
	<sql id="paginationSql">
		<![CDATA[ and rn >#{start_num} and rn <= #{end_num} ]]>   
	</sql>
	<select id="getAccountIdByName"  parameterType="String" resultType="account">
		select * from t_account where isdeleted='0' and logname= #{logName,jdbcType=VARCHAR}
	</select>
	<select id="get"  parameterType="String" resultType="tAuthority">
		select * from t_authority where code = #{code,jdbcType=VARCHAR} and isdeleted='1'
	</select>
		
	<select id="getAuthoritysByRole"  parameterType="String" resultType="tAuthority">
		select a.* from t_role2authority  ra ,t_authority a 
		where ra.authorityid = a.code  and a.isdeleted='0' and ra.roleid = #{roleId}
	</select>	
	
	<select id="getMenusByRole"  parameterType="String" resultType="menu">
		select m.id,m.parentid,m.title,m.isdeleted,m.icon,m.href,m.opened from t_menu m,t_role2menu rm 
		where rm.menuid = m.id and m.isdeleted='0'  and rm.roleid =#{roleId} order by m.id asc
	</select>
	
	
	<select id="getRoles" parameterType="tRole" resultType="tRole">
		select * from (
		select a.*,rownum rn from t_role a where 1=1 and a.isdeleted ='0' 
		and ( a.name like '%'||#{keyWords,jdbcType=VARCHAR}||'%'
 		or a.desp like '%'||#{keyWords,jdbcType=VARCHAR}||'%' ) order by versionTime desc
 		) cc where 1=1  		
		<if test="paginationEnable!='0'.toString()">		
			<include refid="paginationSql"></include>
		</if>
	</select>
	
	<!-- 根据角色id查询正在使用有效账户总数 -->
	<select id="getAccountCntOfRole" parameterType="String" resultType="int">
		 select count(1) from t_account ta ,t_account2role tr 
 		where tr.accountid = ta.id and ta.isdeleted='0' 
 		and tr.roleid = #{roleId}
	</select>
	
	<update id="delete" parameterType="String" >
		update t_role set isdeleted='1',versionTime=sysdate where id = #{id}
	</update>
	
	<insert id="insert" parameterType="TRole" >
		insert into t_role (id,name,desp,creator,createtime,versiontime,createorgid,isdeleted) values
		(#{id},#{name,jdbcType=VARCHAR},#{desp,jdbcType=VARCHAR},#{creator,jdbcType=VARCHAR},sysdate,sysdate,#{createOrgId,jdbcType=VARCHAR},'0')
	</insert>
	
	<select id="getAuthsOfThisRole"  parameterType="String" resultType="TAuthority">
		select a.* from t_role2authority ra ,t_authority a where a.code = ra.authorityid
 		and a.isdeleted='0' and ra.roleid = #{roleId}
	</select>
	
</mapper>   